<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="pages/index.css" rel="stylesheet">
  <title>Место</title>
</head>
<body>
  <div class="page">
    <div id="profile-edit-popup" class="popup popup_hidden">
      <div class="popup__content">
        <button type="button" class="popup__close button button_type_close" aria-label="Закрыть"></button>
        <form class="edit-form">
          <h3 class="edit-form__title">Редактировать профиль</h3>
          <div class="edit-form__inputs">
            <input type="text" name="name" class="edit-form__text-input text-input" value="Жак-Ив Кусто">
            <input type="text" name="description" class="edit-form__text-input text-input" value="Исследователь океана">
          </div>
          <button type="submit" class="edit-form__submit button button_type_save">Сохранить</button>
        </form>
      </div>
    </div>
    <div id="add-card-popup" class="popup popup_hidden">
      <div class="popup__content">
        <button type="button" class="popup__close button button_type_close" aria-label="Закрыть"></button>
        <form class="edit-form">
          <h3 class="edit-form__title">Новое место</h3>
          <div class="edit-form__inputs">
            <input type="text" name="name" class="edit-form__text-input text-input" placeholder="Название">
            <input type="text" name="link" class="edit-form__text-input text-input" placeholder="Ссылка на картинку">
          </div>
          <button type="submit" class="edit-form__submit button button_type_save">Сохранить</button>
        </form>
      </div>
    </div>
    <div class="page__container">
      <header class="page__header header">
        <img src="./images/logo.svg" class="header__image" alt='Логотип "Место"'>
      </header>
      <main class="page__main">
        <section class="top-bar" aria-label="Заголовок профиля">
          <div class="top-bar__profile profile" aria-label="Профиль пользователя Жак-Ив Кусто">
            <img src="./images/avatar.png" class="profile__avatar" alt="Аватар пользователя Жак-Ив Кусто">
            <div class="profile__text">
              <div class="profile__name-wrapper">
                <h1 class="profile__name">Жак-Ив Кусто</h1>
                <button type="button" class="profile__edit button button_type_edit"></button>
              </div>
              <p class="profile__description">Исследователь океана</p>
            </div>
          </div>
          <button type="button" class="top-bar__add button button_type_add" aria-label="Изменить профиль"></button>
        </section>
        <section class="cards" aria-label="Карточки пользователя Жак-Ив Кусто">
        </section>
      </main>
      <footer class="page__footer footer">
        <p class="footer__text">&copy; 2020 Mesto Russia</p>
      </footer>
    </div>
  </div>
  <template id="card-template">
    <article class="card">
      <img class="card__image" src="images/dombay.jpg" alt="Домбай">
      <div class="card__about">
        <h2 class="card__name">Домбай</h2>
        <button type="button" class="card__like button button_type_like" aria-label="Нравится"></button>
      </div>
      <button type="button" class="card__delete button button_type_delete" aria-label="Удалить"></button>
    </article>
  </template>
  <!-- Popup -->
  <script lang="javascript">
    const openPopup = (popup) => {
      popup.classList.remove("popup_hidden")
    }
    const closePopup = (popup) => {
      popup.classList.add("popup_hidden")
    }

    // Добавляет функционал закрытия всем модальным окнам
    document.querySelectorAll(".popup").forEach((popup) => {
      popup.querySelectorAll(".popup__close").forEach((closeButton) => {
        closeButton.addEventListener("click", () => {
          closePopup(popup)
        })
      })
    })
  </script>
  <!-- Изменение профиля -->
  <script>
    // Добавляет функционал открытия модального окна редактирования профиля
    const profileName = document.querySelector(".profile__name");
    const profileDescription = document.querySelector(".profile__description");
    const profileEdit = document.querySelector(".profile__edit");

    const editProfilePopup = document.querySelector("#profile-edit-popup");
    const editProfileForm = editProfilePopup.querySelector("form");
    const editProfileNameInput = editProfileForm.elements.name;
    const editProfileDescriptionInput = editProfileForm.elements.description;

    const cards = document.querySelector(".cards")

    const updateProfileEditForm = (name, description) => {
      editProfileNameInput.value = name
      editProfileDescriptionInput.value = description
    }

    const updateProfile = (name, description) => {
      profileName.textContent = name;
      profileDescription.textContent = description;
      cards.setAttribute("aria-label", `Карточки пользователя ${name}`)
    }

    profileEdit.addEventListener("click", () => {
      updateProfileEditForm(profileName.textContent, profileDescription.textContent)
      openPopup(editProfilePopup)
    })

    editProfileForm.addEventListener("submit", (e) => {
      updateProfile(editProfileNameInput.value, editProfileDescriptionInput.value);
      closePopup(editProfilePopup);
      e.preventDefault();
    })
  </script>
  <!-- Рендер карточек -->
  <script lang="javascript">
    const renderCard = (card, container) => {
      const cardTemplate = document.querySelector("#card-template");
      const cardElement = cardTemplate.content.querySelector(".card").cloneNode(true);
      cardElement.querySelector(".card__image").src = card.link;
      cardElement.querySelector(".card__image").alt = card.name;
      cardElement.querySelector(".card__name").textContent = card.name;

      const cardLikeButton = cardElement.querySelector(".card__like")
      cardLikeButton.addEventListener("click", () => {
        cardLikeButton.classList.toggle("card__like_liked");
      })

      const cardDeleteButton = cardElement.querySelector(".card__delete")
      cardDeleteButton.addEventListener("click", () => {
        cardElement.remove();
      })

      container.appendChild(cardElement);
    }

    // Начальные карточки
    const initialCards = [
      {
        name: 'Архыз',
        link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/arkhyz.jpg'
      },
      {
        name: 'Челябинская область',
        link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/chelyabinsk-oblast.jpg'
      },
      {
        name: 'Иваново',
        link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/ivanovo.jpg'
      },
      {
        name: 'Камчатка',
        link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kamchatka.jpg'
      },
      {
        name: 'Холмогорский район',
        link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/kholmogorsky-rayon.jpg'
      },
      {
        name: 'Байкал',
        link: 'https://pictures.s3.yandex.net/frontend-developer/cards-compressed/baikal.jpg'
      }
    ];

    const cardsSection = document.querySelector(".cards");
    initialCards.forEach((card) => {
      renderCard(card, cardsSection)
    })
  </script>
  <!-- Добавление карточек -->
  <script>
    // Добавляет функциональность открытия модального окна создания карточки
    const addCardButton = document.querySelector(".top-bar__add");

    const addCardPopup = document.querySelector("#add-card-popup");
    const addCardForm = addCardPopup.querySelector("form");
    const addCardNameInput = addCardForm.elements.name;
    const addCardLinkInput = addCardForm.elements.link;

    addCardButton.addEventListener("click", () => {
      addCardNameInput.value = ""
      addCardLinkInput.value = ""
      openPopup(addCardPopup)
    })

    addCardForm.addEventListener("submit", (e) => {
      renderCard({
        name: addCardNameInput.value,
        link: addCardLinkInput.value
      }, cards)
      closePopup(addCardPopup)
      e.preventDefault()
    })
  </script>
</body>
</html>